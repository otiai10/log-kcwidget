<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="/public/stylesheets/common.css">
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script type="text/javascript" src="/public/javascripts/tmp.js"></script>
    <script type="text/javascript" src="/public/javascripts/events.js"></script>
    <script type="text/javascript">
      google.load("visualization", "1", {packages:["corechart"]});
      google.setOnLoadCallback(drawChart);
      function drawChart() {
        var options = {
          title: 'OCR Success Rate',
          hAxis: {title: 'DATE',  titleTextStyle: {color: '#333'}},
          vAxis: {
            0 : {minValue: 0},
            1 : {minValue: 0},
            maxValue : 100
          },
          seriesType : "area",
          isStacked : true,
          series : {
            0 : {targetAxisIndex : 0},
            1 : {targetAxisIndex : 0},
            2 : {targetAxisIndex : 1 , isStacked : false , type:'line', color : 'green' }
          }
        };
        var data = new google.visualization.DataTable();
        var charData = [["Date","Success","Failure"]];
        data.addColumn('string','date');
        data.addColumn('number','Success');
        data.addColumn('number','Failure');
        data.addColumn('number','Rate(%)');
        $.get('/ocr/summary',{},
          function(summary){
            console.log(summary);
            $.each(summary, function(){
              console.log(this);
              var index = this.Date+'/'+this.Hour+':';
              var rate = Math.floor(this.Success * 100 / (this.Success + this.Failure));
              data.addRow([index, this.Success, this.Failure, rate]);
            });
            var chart = new google.visualization.ComboChart(document.getElementById('ocr-summary-chart'));
            chart.draw(data, options);
          }
        );
      }
    </script>
  </head>
  <body>
    <h1><a href="/ocr">OCR</a> log</h1>
    <p>Total <b>{{.count}}</b> records</p>
    <div id="ocr-summary-chart"></div>
    <p>latest 10 records below</p>
    <table><tbody>
      {{range .reports}}
      <tr id="{{.CreatedTime}}">
        <td>
          <small><a class="created-time" href="/ocr/{{.CreatedTime}}" data="{{.CreatedTime}}">{{.CreatedTime}}</a></small><br>
          <span class="proxy" cols="50" rows="50">{{.ImgURI}}</span>
        </td>
        <td>
          -{{.RawText}}<br>
          +{{.AssuredText}}
        </td>
        <td>
          {{.Result}}<br>
          {{.UserAgent}}
        </td>
        <td>
          <input type="submit" class="delelte-record" target="{{.CreatedTime}}" value="delete">
        </td>
      </tr>
      {{end}}
    </tbody></table>
    <div class="paging">
        <a href="/ocr/page/0">0</a> | <a href="/ocr/page/1">1</a>
    </div>
  </body>
</html>
